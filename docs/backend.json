{
    "entities": {
        "User": {
            "title": "User",
            "description": "Represents a user in the system.",
            "type": "object",
            "properties": {
                "name": {
                    "type": "string",
                    "description": "The user's full name."
                },
                "email": {
                    "type": "string",
                    "format": "email",
                    "description": "The user's email address."
                },
                "role": {
                    "type": "string",
                    "enum": ["Admin", "PM", "Technician"],
                    "description": "The role of the user."
                },
                "avatarUrl": {
                    "type": "string",
                    "format": "uri",
                    "description": "URL of the user's avatar image."
                }
            },
            "required": ["name", "email", "role"]
        },
        "Site": {
            "title": "Site",
            "description": "Represents a physical site location.",
            "type": "object",
            "properties": {
                "name": {
                    "type": "string"
                },
                "location": {
                    "type": "string"
                },
                "imageUrl": {
                    "type": "string",
                    "format": "uri"
                },
                "imageHint": {
                    "type": "string"
                },
                "technicianId": {
                    "type": "string"
                }
            },
            "required": ["name", "location", "imageUrl", "technicianId"]
        },
        "Task": {
            "title": "Task",
            "description": "A single task within a PM checklist.",
            "type": "object",
            "properties": {
                "title": { "type": "string" },
                "description": { "type": "string" },
                "type": { "type": "string", "enum": ["static", "dynamic"] },
                "fields": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "properties": {
                            "id": { "type": "string" },
                            "label": { "type": "string" },
                            "type": { "type": "string", "enum": ["checkbox", "text", "number", "photo"] }
                        },
                        "required": ["id", "label", "type"]
                    }
                }
            },
            "required": ["title", "description", "type"]
        },
        "WeeklyPM": {
            "title": "Weekly PM",
            "description": "A weekly preventative maintenance plan.",
            "type": "object",
            "properties": {
                "weekIdentifier": { "type": "string" },
                "siteId": { "type": "string" },
                "assignedTechnicianId": { "type": "string" },
                "status": { "type": "string", "enum": ["Pending", "In Progress", "Completed", "Reviewed", "Cancelled"] },
                "crNumber": { "type": "string" },
                "tasks": {
                    "type": "array",
                    "items": {
                      "$ref": "#/backend/entities/TaskResult"
                    }
                },
                 "comments": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "userId": {"type": "string"},
                        "text": {"type": "string"},
                        "timestamp": {"type": "string", "format": "date-time"}
                      }
                    }
                }
            },
            "required": ["weekIdentifier", "siteId", "status", "tasks"]
        },
        "TaskResult": {
          "title": "Task Result",
          "description": "The result of a technician performing a task.",
          "type": "object",
          "properties": {
            "taskId": { "type": "string" },
            "isCompleted": { "type": "boolean" },
            "notes": { "type": "string" },
            "photos": { "type": "array", "items": { "type": "string", "format": "uri" }},
            "location": { "type": "object", "properties": {"lat": {"type": "number"}, "lng": {"type": "number"}}},
            "checklist": { "type": "object" },
            "customFields": { "type": "object" }
          }
        },
        "ChangeRequest": {
            "title": "Change Request",
            "description": "A request for a change or repair.",
            "type": "object",
            "properties": {
                "siteId": { "type": "string" },
                "city": { "type": "string" },
                "technicianName": { "type": "string" },
                "startDate": { "type": "string", "format": "date-time" },
                "endDate": { "type": "string", "format": "date-time" },
                "title": { "type": "string", "enum": ["برای PM", "برای رفع خرابی", "برای بازدید در موارد خاص"] },
                "description": { "type": "string" },
                "submittedBy": { "type": "string" },
                "createdAt": { "type": "string", "format": "date-time" },
                "status": { "type": "string", "enum": ["باز", "در حال انجام", "انجام شده", "رد شده"] },
                "priority": { "type": "string", "enum": ["کم", "متوسط", "زیاد", "بحرانی"] },
                "photos": { "type": "array", "items": { "type": "string", "format": "uri" } }
            },
            "required": ["siteId", "title", "description", "submittedBy", "createdAt", "status", "priority"]
        }
    },
    "auth": {
        "providers": ["password"]
    },
    "firestore": {
        "/users/{userId}": {
            "schema": { "$ref": "#/backend/entities/User" },
            "description": "Stores user profile information."
        },
        "/sites/{siteId}": {
            "schema": { "$ref": "#/backend/entities/Site" },
            "description": "Stores information about different sites."
        },
        "/tasks/{taskId}": {
            "schema": { "$ref": "#/backend/entities/Task" },
            "description": "Stores predefined maintenance tasks."
        },
        "/pms/{pmId}": {
            "schema": { "$ref": "#/backend/entities/WeeklyPM" },
            "description": "Stores the weekly PM plans assigned to technicians."
        },
        "/changeRequests/{crId}": {
            "schema": { "$ref": "#/backend/entities/ChangeRequest" },
            "description": "Stores change and repair requests."
        }
    }
}
